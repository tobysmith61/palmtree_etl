{% extends "admin/change_form.html" %}

{% block object-tools %}
    {% if original and show_backfill_source_fields_from_canonical_fields_button %}
    <a class="button" href="{% url 'admin:backfill_source_fields_from_canonical_fields' original.id %}">
        Backfill Source Fields from Canonical Fields xxx DMS Vehicle ID, Vehicle Reg, Brand, Model, Firat Reg, VIN17
    </a>
    {% endif %}
{% endblock %}

{% block after_related_objects %}
    {{ block.super }}

    {% if removed_mappings %}
        <fieldset class="module aligned">
            <h2 style="color:#d9534f;">❌ Removed Canonical Fields</h2>

            <table class="admin-table">
                <thead>
                    <tr>
                        <th>Canonical Field</th>
                        <th>Last Source Mapping</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for mapping in removed_mappings %}
                        <tr style="opacity:0.7;">
                            <td>{{ mapping.canonical_field }}</td>
                            <td>{{ mapping.source_field_name|default:"—" }}</td>
                            <td>
                                <strong style="color:#d9534f;">
                                    Removed from canonical schema
                                </strong>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </fieldset>
    {% endif %}
{% endblock %}
